--- Test properties of the 'Environment' module
module tests.qc.Environment where

import System.Environment as E
import Test.QuickCheck

-- since we don't (yet) have Test.QuickCheck.Monadic we will cheat here
-- and use IO.performUnsafe since these functions doen't actually have
-- any side effects (despite their IO types)

-- this may break once real main arguments are wired in, depending on
-- how the tests are actually invoked:
p_getArgsEmpty = once ( IO.performUnsafe (getArgs) == [] )

p_getProgNameEmpty = once ( IO.performUnsafe (getProgName) == "" )

-- PATH should be available even on Windows so this should be a safe test:
p_getEnvPathOk = once ( IO.performUnsafe (getEnv "PATH") /= "" )

-- this should yield an environment variable name that we will never have:
noSuchEnv = "NoSuchEnvironmentVariable"

-- getEnv throws IllegalArgumentException with the name of the unknown
-- environment variable as the message value:
accept :: IllegalArgumentException -> IO String
accept t = return ("IAE" ++ t.getMessage)

p_getEnvUnknownThrows = once ( IO.performUnsafe (getEnv noSuchEnv `catch` accept) == "IAE" ++ noSuchEnv )
